
#### 关键路径

##### 1. AOE-网 的概念

与 AOV-网 相对应的是 **AOE-网（Activity On Edge）** 即边表示活动的网。AOE-网是一个带权的有向无环图，其中，顶点表示事件（Event），弧表示活动，权表示活动持续的时间。通常，AOE-网可用来估算工程的完成时间。

例如，图 7.29 是一个假想的有 11 项活动的 AOE-网。其中有 9 个事件，$v_{1}, v_{2}, v_{3}, \cdots, v_{9}$，每个事件表示在它之前的活动已经完成，在它之后的活动可以开始。如 $v_1$ 表示整个工程开始，$v_9$ 表示整个工程结束，$v_5$ 表示 $a_4$ 和 $a_5$ 已经完成，$a_7$ 和 $a_8$ 可以开始。与每个活动相联系的数是执行该活动所需的时间。比如，活动 $a_1$ 需要 6 天，$a_2$ 需要 4 天等。

![](https://gitee.com/mayundaze/img_bed/raw/master/20200706101734.png)

由于整个工程只有一个开始点和一个完成点，故在正常的情况（无环）下，网中只有一个入度为零的点（称做 **源点**）和一个出度为零的点（叫做 **汇点**）。

##### 2. AOE-网 要研究的问题

和 AOV-网不同，对 AOE-网有待研究的问题是：

（1）完成整项工程至少需要多少时间？
（2）哪些活动是影响工程进度的关键？

##### 3. 关键路径 和 关键活动

由于在 AOE-网中有些活动可以并行地进行，所以完成工程的最短时间是从开始点到完成点的最长路径的长度（这里所说的路径长度是指路径上各活动持续时间之和，不是路径上弧的数目）。路径长度最长的路径叫做 **关键路径（Critical Path）**。

假设开始点是$v_1$，从 $v_1$ 到 $v_i$ 的最长路径长度叫做事件 $v_i$ 的 **最早发生时间**。这个时间决定了所有以 $v_i$ 为尾的弧所表示的活动的最早开始时间。我们用 $e(i)$ 表示活动 $a_i$ 的 **最早开始时间**。还可以定义一个活动的 **最迟开始时间 $l(i)$**，这是在不推迟整个工程完成的前提下，活动 $a_i$ 最迟必须开始进行的时间。两者之差 $l(i) - e(i)$ 意味着完成活动 $a_i$ 的 **时间余量**。

我们把 $l(i) = e(i)$ 的活动叫做**关键活动**。显然，关键路径上的所有活动都是关键活动，因此提前完成非关键活动并不能加快工程的进度。

例如图 7.29 中的网，从 $v_1$ 到 $v_9$ 的最长路径是 $\left(v_{1}, v_{2}, v_{5}, v_{8}, v_{9}\right)$，路径长度是 18, 即 $v_9$ 的最早发生时间是 18。而活动 $a_6$ 的最早开始时间是 5, 最迟开始时间是 8, 

> 从 $V_1$ 到 $V_6$ 再到 $V_9$ 的时间余量 = 最长路径 - (v_1,v_4,v_6,v_8,v_9 的路径长度) = 18 - (5 + 2 + 4 + 4) = 18 - 15 = 3
> 活动 $a_6$ 的最迟开始时间 = 活动 $a_6$ 的最早开始时间 + 从 $V_1$ 到 $V_6$ 再到 $V_9$ 的时间余量

这意味着：如果 $a_6$ 推迟 3 天开始或者延迟 3 天完成，都不会影响整个工程的完成。因此，分析关键路径的目的是辨别哪些是关键活动，以便争取提高关键活动的工效，缩短整个工期。

##### 4. 辨别关键活动的步骤

由上分析可知，辨别关键活动就是要找 $e(i) = l(i)$ 的活动。为了求得 AOE-网 中活动的 $e(i)$ 和 $l(i)$，首先应求得事件的最早发生时间 $ve(j)$ 和最迟发生时间 $vl(j)$。如果活动 $a_i$ 由弧 $\langle j, k\rangle$ 表示，其持续时间记为 $dut(\langle j, k\rangle)$，则有如下关系

$\qquad e(i) = ve(j) \qquad\qquad\qquad\qquad\qquad\qquad\qquad\; (7-1)$

$\qquad l(i) = vl(k) - dut(\langle j, k\rangle)$

求 $ve(j)$ 和 $vl(j)$ 需分两步进行:

$(1)$ 从 $ve(0) = 0$ 开始向前递推

$\qquad\begin{aligned} v(j) &=\operatorname{Max}\{v e(i)+d u t(\langle i, j\rangle)\} \end{aligned} \qquad\qquad\qquad (7-2)$

$\qquad\begin{aligned} \qquad\langle i, j\rangle \in T, & j=1,2, \cdots, n-1 \end{aligned}$

其中，T 是所有以第 j 个顶点为头的弧的集合。

$(2)$ 从 $vl(n - 1) = ve(n - 1)$ 起向后递推

$\qquad\begin{aligned} vl(i) = \underset{j}{\operatorname{Min}} \{v l(j)-d u t(\langle i, j\rangle)\}\end{aligned} \qquad\qquad\qquad (7-3)$

$\qquad\begin{aligned} \qquad\langle i, j\rangle \in S, \quad i=n-2, \cdots, 0 \end{aligned}$

其中，$S$ 是所有以第 $i$ 个顶点为尾的弧的集合。

这两个递推公式的计算必须分别在 拓扑有序 和 逆拓扑有序 的前提下进行。也就是说，$ve(j - 1)$ 必须在 $v_j$ 的所有前驱的最早发生时间求得之后オ能确定，而 $vl(j - 1)$ 则必须在 $v_j$ 的所有后继的最迟发生时间求得之后才能确定。因此，可以在拓扑排序的基础上计算 $ve(j - 1)$ 和 $vl(j - 1)$
