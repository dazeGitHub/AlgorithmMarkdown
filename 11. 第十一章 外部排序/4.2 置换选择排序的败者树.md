
#### 置换选择排序的败者树

利用败者树对前面例子进行置换一选择排序时的局部状况如图 11.6 所示:

![](https://gitee.com/mayundaze/img_bed/raw/master/20200805163838.png)

* 其中图 $11.6(a) ~ (g)$ 显示了败者树建立过程中的状态变化状况。
* 图 $11.6(h)$ 所示：最后得到最小关键字的记录为 $wa[0]$，之后，输出 $wa[0].rec$，并从 FI 中输入下一个记录至 $waL[0]$，由于它的关键字小于刚刚输出的记录的关键字，则设此新输人的记录的段号为 2。
* 图 $11.6(i)$ 所示：由于在输出 $wa[1]$ 之后新输人的关键字较 $wa[1].key$ 大，则该新输入的记录的段号仍为 1。
* 图 $11.6(j)$ 所示为在输出 6 个记录之后选得的 MINIMAX 记录为 $wa[1]$ 时的败者树。
* 图 $11.6(k)$ 表明在输出该记录 $wa[1]$ 之后，由于输入的下一个记录的关键字较小，其段号亦为 2, 致使工作区中所有记录的段号均为 2。由此败者树选出的新的 MINIMAX 记录的段号大于当前生成的归并段的序号，这说明该段已结東，而此新的 MINIMAX 记录应是下一归并段中的第一个记录。

从上述可见，由置换-选择排序所得初始归并段的长度不等。且可证明，当输入文件中记录的关键字为随机数时，所得初始归并段的平均长度为内存工作区大小的两倍。这个证明是 E.F.Moore 在 1961 年从 置换-选择排序 和 扫雪机的类比中得出的。

> 假设一台扫雪机在环形路上等速行进扫雪，又下雪的速度也是均匀的（即每小时落到地面上的雪量相等），雪均匀地落在扫雪机的前、后路面上，边下雪边扫雪。显然，在某个时刻之后，整个系统达到平衡状态，路面上的积雪总量不变。且在任何时刻，整个路面上的积雪都形成一个均匀的斜面，紧靠扫雪机前端的积雪最厚，其深度为 $h$，而在扫雪机刚扫过的路面上的积雪深度为零。若将环形路伸展开来，路面积雪状态如图 11.7 所示。假设此刻路面积雪的总体积为 $m$，环形路一圏的长度为 $l$，由于扫雪机在任何时刻扫走的雪的深度均为 $h$，则扫雪机在环形路上走一圈扫掉的积雪体积为 $lh$ 即 $2w$。
>
> ![](https://gitee.com/mayundaze/img_bed/raw/master/20200805164229.png)

将置换-选择排序与此类比，工作区中的记录好比路面的积雪，输出的 MINIMAX 记录好比扫走的雪，新输入的记录好比新下的雪，当关键字为随机数时，新记录的关键字比 MINIMAX 大或小的概率相等。若大，则属当前的归并段（好比落在扫雪机前面的积雪，在这一圈中将被扫走）；若小，则属下一归并段（好比落在扫雪机后面的积雪，在下一圈中才能扫走）。由此，得到一个初始归并段好比扫雪机走一圈。假设工作区的容量为 $u$，则置换一选择所得初始归并段长度的期望值便为 $2w$。

容易看出，若不计输人、输出的时间，则对 $n$ 个记录的文件而言，生成所有初始归并段所需时间为 $O(n log w)$。
