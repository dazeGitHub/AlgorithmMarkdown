
上一章中已提到，外部排序指的是大文件的排序，即待排序的记录存储在外存储器上，在排序过程中需进行多次的内、外存之间的交换。因此，在本章讨论外部排序之前，首先需要了解对外存信息进行存取的特点。

#### 外部信息的存取

计算机一般有两种存储器：内存储器（主存）和外存储器（辅存）。内存的信息可随机存取，且存取速度快，但价格贵、容量小。外存储器包括磁带和磁盘（或磁鼓），前者为顺序存取的设备，后者为随机存取的设备。

##### 1. 磁带信息的存取

磁带是薄薄涂上一层磁性材料的一条窄带。现在使用的磁带大多数有 1/2 英寸宽，最长可达 3600 英尺，绕在一个卷盘上。使用时，将磁带盘放在磁带机上，驱动器控制磁带盘转动，带动磁带向前移动。通过读/写头就可以读出磁带上的信息或者把信息写人磁带中（图 11.1)。

![](https://gitee.com/mayundaze/img_bed/raw/master/20200805114953.png)

在 1/2 英寸宽的带面上可以记录 9 位或 7 位二进制信息（通常称为 9 道带或 7 道带）。以 9 道带为例，每横排就可表示一个字符（8 位表示一个字符，另一位作奇偶校验位）。因此，磁带上可记下各种文字信息或二进制信息。在磁带上信息按字符组存放，而不是按字符存放。

> 字符组在操作系统的一些描述中称为“记录”。注意：操作系统中的“记录”不同于本书前面定义的记录。

磁带上信息的密度通常为每英寸 800 位或 1600 位或 6250 位（即每英寸的二进制字符数），移动速度是每秒 200 英寸。

磁带不是连续运转的设备，而是一种启停设备（启停时间约为 5 毫秒），它可以根据读 /写的需要随时启动和停止。由于读/写信息应在旋转稳定时进行，而磁带从静止状态启动后，要经过一个加速的过程才能达到稳定状态;反之，在读/写结東后，从运动状态到完全停止，要经过一个减速的过程。因此，在磁带上相邻两组字符组（记录）之间要留一空白区，叫做 **间隙 IRG (Inter Record Gap)**。根据启停时间的需要，这个间隙通常为 1/4 ~ 3/4 英寸。如果每个字符组的长度是80个字符，IRG 为 3/4英寸，则对密度为每英寸 1600 个字符的磁带，其利用率仅为 1/16，有 15/16 的带用于 IRG(参见图11.2(a））。

为了有效地利用磁带，常常用组成块的办法来减少 IRG 的个数。在每次写信息时，不是按用户给出的字符组记人磁带，而是将若干个字符组合并成一块后一次写入磁带。于是，每个字符组间就没有 IRG，而变成 **块间的间隙 IBG (Inter Block Gap)**。图 $1.2 (b)$:

![](https://gitee.com/mayundaze/img_bed/raw/master/20200805115239.png)

表示将 20 个长度为 80 字符的字符组存放在磁带上的一个物理块中的情况。

成块的办法可以减少 IRG 的数目，从而可以提高磁带的利用率，块的长度大于 IBG 的长度。成块还可减少I/O操作。因为一次 I/O 操作可把整个物理块都读到内存缓冲区中，然后再从缓冲区中取出所需要的信息（一个字符组）。每当要读一个字符组时，首先要査缓冲区中是否已有，若有，则不必执行I/O操作，直接从缓冲区读取即可。软件要有处理成块、解块和保存字符组的功能。在使用者看来，每次读/写的却只是一个字符组。

是否物理块越大，数据越紧凑，效率就越高呢？实际上不是这样的。物理块不能太大，通常只有 1K 字节 ~ 8K 字节。这是因为如果一次读写太长，则出错的概率就增大，可靠性就降低；此外，若块太大，则在内存开辟的缓冲区就大，从而耗费内存空间也多。

在磁带上读写一块信息所需的时间由两部分组成：

$\qquad T_{I / O} = t_{a} + n \cdot t_{w}$

其中: $t_a$ 为延迟时间，读/写头到达传输信息所在物理块起始位置所需时间; $t_w$ 为传输个字符的时间。

显然，延迟时间和信息在磁带上的位置、当前读/写头所在位置有关。例如，若读/写头在第 $i$ 和第 $i + 1$ 个物理块之间的间隙上，则读第 $i + 1$ 个物理块上的信息仅需几毫秒; 若读/写头位于磁带的始端，而要读的信息在磁带的尾端，则必须使磁带向前运动，跳过中间的许多块，直到所需信息通过读/写头时才能得到，这可能需要几分钟的时间。因此，由于磁带是顺序存取的设备，则读/写信息之前先要进行顺序查找，并且当读/写头位于磁带尾端，而要读的信息在磁带始端时，尚使磁带倒转运动。这是顺序存取设备的主要缺点，它使检索和修改信息很不方便。因此，顺序存取设备主要用于处理变化少、只进行顺序存取的大量数据。

##### 2. 磁盘信息的存取

磁盘是一种直接存取的存储设备（DASD）。它是以存取时间变化不大为特征的。它不像磁带那样只能进行顺序存取，而可以直接存取任何字符组。它的容量大、速度快，存取速度比磁带快得多。磁盘是一个扁平的圆盘（与电唱机的唱片类似），盘面上有许多称为磁道的圆圈，信息就记载在磁道上。由于磁道的园圈为许多同心圆，所以可以直接存取。磁盘可以是单片的，也可以由若干盘片组成盘组。每一片上有两个面。以 6 片盘组为例，由于最顶上和最低下盘片的外侧面不存信息，所以总共只有 10 个面可用来保存信息，如图 11.3 所示。

![](https://gitee.com/mayundaze/img_bed/raw/master/20200805134510.png)

磁盘驱动器执行读/写信息的功能。盘片装在一个主轴上，并绕主轴高速旋转，当磁道在读/写头下通过时，便可以进行信息的读/写。可以把磁盘分为固定头盘和活动头盘。固定头盘的每一道上都有独立的磁头，它是固定不动的，专负责读/写某一道上的信息。

活动头盘的磁头是可移动的。盘组也是可变的。一个面上只有一个磁头，它可以从该面上的一道移动到另一道。磁头装在一个动臂上，不同面上的磁头是同时移动的，并处于同一圆柱面上。各个面上半径相同的磁道组成一个圆柱面，圆柱面的个数就是盘片面上的磁道数。通常，每个面上有 200~400 道。在磁盘上标明一个具体信息必须用一个三维地址：柱面号、盘面号、块号。

其中，柱面号确定读/写头的径向运动，而块号确定信息在盘片圆圈上的位置。

为了访问一块信息，首先必须找柱面，移动臂使磁头移动到所需柱面上（称为定位或寻查）；然后等待要访问的信息转到磁头之下;最后，读/写所需信息。所以，在磁盘上读写一块信息所需的时间由 3 部分组成：

$\qquad T_{I / O} = t_{seck} + t_{la} + n \cdot t_{w m}$

其中：$t_{seck}$ 为寻查时间（seek time)，即读/写头定位的时间；$t_{la}$ 为等待时间（latency time），即等待信息块的初始位置旋转到读写头下的时间；$t_{w m}$ 为传输时间（transmission time）。

由于磁盘的旋转速度很快，约 2400~3600 转/分,则等待时间最长不超过25毫秒(旋转圈的时间)，磁盘的传输速率一般在 $10^5$ 字符/秒和 $5 x 10^5$ 字符/秒之间，则在磁盘上读/写信息的时间主要花在寻査时间上(其最大寻査时间约为0.1秒)。因此,在磁盘上存放信息时应将相关的信息放在同一柱面或邻近柱面上,以求在读/写信息时尽量减少磁头来回移动的次数，以避免不必要的寻查时间。