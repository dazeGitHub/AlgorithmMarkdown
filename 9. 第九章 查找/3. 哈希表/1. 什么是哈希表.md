
#### 什么是哈希表

##### 1. 哈希表的定义

在前面讨论的各种结构（线性表、树等）中，记录在结构中的相对位置是随机的，和记录的关键字之间不存在确定的关系，因此，在结构中査找记录时需进行一系列和关键字的比较。这一类查找方法建立在“比较”的基础上。

* 在顺序查找时，比较的结果为 “=” 与“$\neq$” 两种可能；
* 在折半査找、二叉排序树査找和 B- 树査找时，比较的结果为 “<”、“=” 和 “>” 3 种可能。

查找的效率依赖于査找过程中所进行的比较次数。

理想的情况是希望不经过任何比较，一次存取便能得到所査记录，那就必须在记录的存储位置和它的关键字之间建立一个确定的对应关系 `f`，使每个关键字和结构中一个惟一的存储位置相对应。因而在查找时，只要根据这个对应关系 `f` 找到给定值 `K` 的像 `f(K)`。若结构中存在关键字和 `K` 相等的记录，则必定在 `f(K)` 的存储位置上，由此，不需要进行比较便可直接取得所查记录。在此，我们称这个对应关系 `f` 为 **哈希（Hash）函数**，按这个思想建立的表为 **哈希表**。

##### 2. 哈希表实例

我们可以举一个哈希表的最简单的例子。假设要建立一张全国 34 个地区的各民族人口统计表，每个地区为一个记录，记录的各数据项为：

![](https://gitee.com/mayundaze/img_bed/raw/master/20200714154906.png)

###### 简单的哈希函数

显然，可以用一个一维数组 `C(1..30)` 来存放这张表，其中 `C[i]` 是编号为 `i` 的地区的人口情况。编号 `i` 便为记录的关键字，由它惟一确定记录的存储位置 `C[i]`。

> 例如：假设北京市的编号为 1，则若要査看北京市的各民族人口，只要取出 `C[1]` 的记录即可。假如把这个数组看成是哈希表，则哈希函数 $f(key)=key$。

然而，很多情况下的哈希函数并不如此简单。可仍以此为例，为了查看方便应以地区名作为关键字。假设地区名以汉语拼音的字符表示，则不能简单地取哈希函数 $f(key)=key$，而是首先要将它们转化为数字，有时还要作些简单的处理。

###### 复杂的哈希函数

例如我们可以有这样的哈希函数：

1. 取关键字中第一个字母在字母表中的序号作为哈希函数 ($f_1$ 函数)。

例如：BEIJING 的哈希函数值为字母“B”在字母表中的序号，等于 02; 

2. 或先求关键字的第一个和最后一个字母在字母表中的序号之和，然后判别这个和值，若比 30（表长）大，则减去 30 ($f_2$ 函数)。

例如：TIANJIN 的首尾两个字母“T”和“N”的序号之和为 34, 故取 04 为它的哈希函数值；

3. 或先求每个汉字的第一个拼音字母的 ASCII 码（和英文字母相同）之和的八进制形式，然后将这个八进制数看成是十进制数再除以 30 取余数，若余数为零则加上 30 而为哈希函数值 ($f_3$ 函数)。

例如：HENAN 的头两个拼音字母为“H”和“N”，它们的 ASCII 码之和为 $(226)_8$，以 $(226)_{10}$ 除以 $(30)_{10}$ 得余数为 16, 则 16 为 HENAN 的哈希函数值，即记录在数组中的下标值。

上述人口统计表中部分关键字在这 3 种不同的哈希函数情况下的哈希函数值如表 9.1 所列：

![](https://gitee.com/mayundaze/img_bed/raw/master/20200714160208.png)

从这个例子可见：

(1) 哈希函数是一个映像，因此哈希函数的设定很灵活（Hash 的原意本是杂凑），只要使得任何关键字由此所得的哈希函数值都落在表长允许范围之内即可；

(2) 对不同的关键字可能得到同一哈希地址，即 keyl $\neq$ key 2, 而 $f(key1) = f(key2)$，这种现象称 **冲突（collision）**。具有相同函数值的关键字对该哈希函数来说称做 **同义词（Synonym）**。

> 例如：关键字 HEBEI 和 HENAN 不等，但 $f_1(HEBEI) = f_1(HIENAN)$，又如：$f_2(SHANXI) = f_2(SHANGHAI)$; $f_3(HENAN) = f(SICHUAN)$。这种现象给建表造成困难，如在第一种哈希函数的情况下，因为山西、上海、山东和四川这 4 个记录的哈希地址均为 19, 而 $C[19]$ 只能存放一个记录，那么其他 3 个记录存放在表中什么位置呢？并且，从上表 3 个不同的哈希函数的情况可以看出，哈希函数选得合适可以减少这种冲突现象。特别是在这个例子中。只可能有 30 个记录，可以仔细分析这 30 个关键字的特性，选择一个恰当的哈希函数来避免冲突的发生。

然而，在一般情况下，冲突只能尽可能地少，而不能完全避免。因为，哈希函数是从关键字集合到地址集合的映像。通常，关键字集合比较大，它的元素包括所有可能的关键字，而地址集合的元素仅为哈希表中的地址值。假设表长为 n，则地址为 0 到 $n - 1$。例如，在 C 语言的编译程序中可对源程序中的标识符建立一张哈希表。

在设定哈希函数时考虑的关键字集合应包含所有可能产生的关键字；假设标识符定义为以字母为首的 8 位字母或数字，则关键字（标识符）的集合大小为 $C_{52}^{1} * C_{62}^{7} * 7 !=1.288899 \times 10^{14}$, 而在一个源程序中出现的标识符是有限的，设表长为 1000 足矣。地址集合中的元素为 0 到 999 因此，在一般情况下，哈希函数是一个压缩映像，这就不可避免产生冲突。因此，在建造哈希表时不仅要设定一个“好”的哈希函数，而且要设定一种处理冲突的方法。

> $C_{52}^{1}$ 表示从 52 (26 个大写字母 + 26 个小写字母) 中选取一个，$A_n^m = C_n^m \cdot m!$，所以 $C_{62}^7 * 7! = A_{62}^7$，即从 62 个大小写字母加数字中取 7 个进行排列

##### 3. 总结

综上所述，可如下描述哈希表：**根据设定的哈希函数 $H(key)$ 和处理冲突的方法将组关键字映像到一个有限的连续的地址集（区间）上，并以关键字在地址集中的“像”作为记录在表中的存储位置，这种表便称为哈希表**，这一映像过程称为 **哈希造表** 或 **散列**，所得存储位置称 **哈希地址** 或 **散列地址**。

下面分别就哈希函数和处理冲突的方法进行讨论。
