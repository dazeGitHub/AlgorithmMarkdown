
#### 哈希函数的构造方法

构造哈希函数的方法很多。在介绍各种方法之前，首先需要明确什么是“好”的哈希函数。

若对于关键字集合中的任一个关键字，经哈希函数映像到地址集合中任何一个地址的概率是相等的，则称此类哈希函数为 **均匀的（Uniform）哈希函数**。换句话说，就是使关键字经过哈希函数得到一个“随机的地址”，以便使一组关键字的哈希地址均匀分布在整个地址区间中，从而减少冲突。

常用的构造哈希函数的方法有：

##### 1. 直接定址法

取关键字或关键字的某个线性函数值为哈希地址。即：

$\qquad H(key) = key$ 或 $H(key) = a \cdot key + b$

其中 a 和 b 为常数（这种哈希函数叫做自身函数）。

例如：有一个从 1 岁到 100 岁的人口数字统计表，其中，年龄作为关键字，哈希函数取关键字自身。如表 9.2 所示：

![](https://gitee.com/mayundaze/img_bed/raw/master/20200728155706.png)

这样，若要询问 25 岁的人有多少，则只要査表的第 25 项即可。

又如：有一个解放后出生的人口调査表，关键字是年份，哈希函数取关键字加一常数 H (key) =key+ (-1948），如表 9.3 所示。

![](https://gitee.com/mayundaze/img_bed/raw/master/20200728155757.png)

这样，若要查 1970 年出生的人数，则只要査第 $(1970 - 1948) = 22$ 项即可。

由于直接定址所得地址集合和关键字集合的大小相同。因此，对于不同的关键字不会发生冲突。但实际中能使用这种哈希函数的情况很少。

##### 2. 数字分析法

假设关键字是以 r 为基的数（如：以 10 为基的十进制数），并且哈希表中可能出现的关键字都是事先知道的，则可取关键字的若干数位组成哈希地址。

例如有 80 个记录，其关键字为 8 位十进制数。假设哈希表的表长为 $100_{10}$, 则可取两位十进制数组成哈希地址。取哪两位？原则是使得到的哈希地址尽量避免产生冲突，则需从分析这 80 个关键字着手。假设这 80 个关键字中的一部分如下所列：

![](https://gitee.com/mayundaze/img_bed/raw/master/20200728160026.png)

对关键字全体的分析中我们发现：第①②位都是“81”，第③位只可能取 1、2、3 或 4, 第⑧ 位只可能取 2、5 或 7, 因此这 4 位都不可取。

由于中间的 4 位可看成是近乎随机的，因此可取其中任意两位，或取其中两位与另外两位的叠加求和后舍去进位作为哈希地址。

> 其中两位与另外两位的叠加求和若超过 100，舍去进位后是个两位数，正好做哈希地址

##### 3. 平方取中法

取关键字平方后的中间几位为哈希地址。这是一种较常用的构造哈希函数的方法。通常在选定哈希函数时不一定能知道关键字的全部情况，取其中哪几位也不一定合适，而一个数平方后的中间几位数和数的每一位都相关，由此使随机分布的关键字得到的哈希地址也是随机的。取的位数由表长决定。

例如：为 BASIC 源程序中的标识符建立一个哈希表。假设 BASIC 语言中允许的标识符为一个字母，或一个字母和一个数字。在计算机内可用两位八进制数表示字母和数字，如图 9.23 (a）所示。

> 大小写字母加数字共 26 + 26 + 10 + 62，而两位八进制数转换为十进制数的最大值为 $77 = 7 \cdot 8^1 + 7 = 56 + 7 = 63$ 算上 $00$ 共 64 个，$64 > 62$，所以用两位八进制数表示字母和数字正好合适

![](https://gitee.com/mayundaze/img_bed/raw/master/20200728160641.png)

取标识符在计算机中的八进制数为它的关键字。假设表长为 $512 = 2^9$, 则可取关键字平方后的中间 9 位二进制数为哈希地址。例如，图 $9.23 (b)$ 列出了一些标识符及它们的哈希地址。

> 3 位 二进制最大的数为 $111 = 1 \cdot 2^2 + 1 \cdot 2^1 + 1 \cdot 2^0 = 4 + 2 + 1 = 7$，即可以用 1 个八进制数表示 3 个二进制数，所以 9 位二进制数可以用 3 个 8 进制数表示
>
> 八进制 2061 转换为十进制为 1073，$1073^2 = 1151329$，$1151329$ 转换为八进制正好为 $4310541$，和表格相符，转换为 2 进制为 $100011 001000101 100001$，取中间九位 $001000101$，将前面的 $100011$ 转换为八进制为 $43$，所以 $4310541$ 的 $43$ 的后的 3 个八进制位即为中间 9 位二进制数，即 105，与表格不相符？？

##### 4. 折叠法

将关键字分割成位数相同的几部分（最后一部分的位数可以不同），然后取这几部分的叠加和（舍去进位）作为哈希地址，这方法称为折叠法（folding）。关键字位数很多，而且关键字中每一位上数字分布大致均匀时，可以采用折叠法得到哈希地址。

例如：每一种西文图书都有一个国际标准图书编号（ISBN），它是一个 10 位的十进制数字，若要以它作关键字建立一个哈希表，当馆藏书种类不到 10000 时，可采用折叠法构造一个四位数的哈希函数。在折叠法中数位叠加可以有 **移位叠加** 和 **间界叠加** 两种方法，移位叠加是将分割后的每一部分的最低位对齐，然后相加；间界叠加是从一端向另一端沿分割界来回折叠，然后对齐相加。如国际标准图书编号 0-442-20586-4 的哈希地址分别如图 9.24 (a）和（b）所示。

![](https://gitee.com/mayundaze/img_bed/raw/master/20200728175232.png)

> 移位叠加法: 0-442-20586-4 从右往左按照 4 位来分割，得到 5864、4220、04，再相加如图 9.24 (a）
> 间界叠加法: 0-442-20586-4 从右往左按照 4 位来折叠，得到 5864、0224、04，再相加如图 9.24 (b）

##### 5. 除留余数法

取关键字被某个不大于哈希表表长 m 的数 p 除后所得余数为哈希地址。即

这是一种最简单，也最常用的构造哈希函数的方法。它不仅可以对关键字直接取模（MOD），也可在折叠、平方取中等运算之后取模。

值得注意的是，在使用除留余数法时，对 p 的选择很重要。若 p 选的不好，容易产生同义词。请看下面 3 个例子。

假设取标识符在计算机中的二进制表示为它的关键字（标识符中每个字母均用两位八进制数表示）, 然后对 $p=2^{6}$ 取模。这个运算在计算机中只要移位便可实现，将关键字左移直至只留下最低的 6 位二进制数。这等于将关键字的所有高位值都忽略不计。因而使得所有最后一个字符相同的标识符，如 a1, il, temp1l, cp1 等均成为同义词。

若 $p$ 含有质因子 $pf$，则所有含有 $pf$ 因子的关键字的哈希地址均为 $pf$ 的倍数。例如，当 $p=21 (= 3 x 7)$ 时，下列含因子 $7$ 的关键字对 $21$ 取模的哈希地址均为 $7$ 的倍数。

![](https://gitee.com/mayundaze/img_bed/raw/master/20200728181816.png)

假设有两个标识符 xy 和 yx，其中 x、y 均为字符，又假设它们的机器代码（6 位二进制数）分别为 $c(x)$ 和 $c(y)$，则上述两个标识符的关键字分别为

$\qquad$ key $1=2^{6} c(x)+c(y)$ 和 key $2=2^{6} c(y)+c(x)$

假设用除留余数法求哈希地址，且 $p = tq$, $t$ 是某个常数，$q$ 是某个质数。则当 $q = 3$ 时，这两个关键字将被散列在差为 3 的地址上。因为

$\qquad [H(k e y 1)-H(k e y 2)] \operatorname{MOD} q$

$\qquad =\left\{\left[2^{6} c(x)+c(y)\right] \operatorname{MOD} p-\left[2^{6} c(y)+c(x)\right] \operatorname{MOD} p\right\} \operatorname{MOD} q$
$\qquad =\left\{2^{6} c(x) \operatorname{MOD} p+c(y) \operatorname{MOD} p-2^{6} c(y) \operatorname{MOD} p-c(x) \operatorname{MOD} p\right\} \operatorname{MOD} q$
$\qquad =\left\{2^{6} c(x) \operatorname{MOD} q+c(y) \operatorname{MOD} q-2^{6} c(y) \operatorname{MOD} q-c(x) \operatorname{MOD} q\right\} \operatorname{MOD} q$
$\quad \text { (因对任一 } x \text { 有 }(x \operatorname{MOD}(t * q)) \operatorname{MOD} q=(x \operatorname{MOD} q) \operatorname{MOD} q)$

$\begin{aligned} \text { 当 } q &=3 \text { 时 }, \text { 上式为 } \\ &=\left\{\left(2^{6} \mathrm{M}(\mathrm{D} 3) c(x) \mathrm{MOD} 3+c(y) \mathrm{MOD} 3-\left(2^{6} \mathrm{M}() \mathrm{D} 3\right) c(y) \mathrm{M} \mathrm{OD} 3-c(x) \mathrm{M} \mathrm{OD}\right.\right.
3\} MOD 3 \end{aligned}$
$=0 \quad \mathrm{MOD} \quad 3$

由众人的经验得知：一般情况下，可以选 p 为质数或不包含小于 20 的质因数的合数

##### 6. 随机数法

选择一个随机函数，取关键字的随机函数值为它的哈希地址，即 $H(key) = random(key)$，其中 `random` 为随机函数。通常，当关键字长度不等时采用此法构造哈希函数较恰当。

实际工作中需视不同的情况采用不同的哈希函数。通常，考虑的因素有：

(1) 计算哈希函数所需时间（包括硬件指令的因素）
(2) 关键字的长度；
(3) 哈希表的大小；
(4) 关键字的分布情况；
(5) 记录的査找频率。