
#### 第二种情况

第二种情况，系统运行期间用户请求分配的存储量有若干种大小的规格。对此类系统，一般情况下是建立若干个可利用空间表，同一链表中的结点大小相同。

例如，某动态存储管理系统中的用户将请求分配 2 个字、4 个字或 8 个字的内存块，则系统建立 3 个结点大小分别为 3 个字、5 个字和 9 个字的链表，它们的表头指针分别为 av2、av4 和 av8。

![](https://gitee.com/mayundaze/img_bed/raw/master/20200706170535.png)

如图 8.3 所示，每个结点中的第一个字设有链域（link）、标志域（tag）和结点类型域（type）。

其中：

$(1)$ 类型域为区别 3 种大小不同的结点而设，type 的值为“0”、“1”或“2”，分别表示结点大小为 2 个字、4 个字或 8 个字；
$(2)$ 标志域 tag 为“0”或“1”分别表示结点为空闲块或占用块；
$(3)$ 链域中存储指向同一链表中下一结点的指针，而结点中的值域是其大小分别为 2、4 和 8 个字的连续空间。

此时的分配和回收的方法在很大程度上和第一种情况类似，只是当结点大小和请求分配的量相同的链表为空时，需查询结点较大的链表，并从中取出一个结点，将其中一部分内存分配给用户，而将剩余部分插入到相应大小的链表中。回收时，也只要将释放的空闲块插入到相应大小的链表的表头中去即可。

然而，这种情况的系统还有一个特殊的问题要处理：即当结点与请求相符的链表和结点更大的链表均为空时，分配不能进行，而实际上内存空间并不一定不存在所需大小的连续空间，只是由于在系统运行过程中，频繁出现小块的分配和回收，使得大结点链表中的空闲块被分隔成小块后插入在小结点的链表中，此时若要使系统能继续运行，就必须重新组织内存，即执行“存储紧缩”的操作。除此之外，上述这个系统本身的分配和回收的算法都比较简单，读者可自行写出。
