
##### 实现存储紧缩的操作步骤

和上节讨论的无用单元收集类似，为实现存储紧缩，首先要对占用块进行“标志”，标志算法和上节类同（存储块的结构可能不同）；其次需进行下列 4 步操作：

$(1)$ 计算占用块的新地址。从最低地址始巡査整个存储空间，对每一个占用块找到它在紧缩后的新地址。为此，需设立两个指针随巡査向前移动，这两个指针分别指示占用块在紧缩之前的原地址和紧缩之后新地址。因此，在每个占用块的第一个存储单位中，除了设立长度域（存储该占用块的大小）和标志域（存储区别该存储块是占用块或空闲块的标志）之外，还需设立一个新地址域，以存储占用块在紧缩后应有的新地址，即建立一张新、旧地址的对照表。

$(2)$ 修改用户的初始变量表，以便在存储紧缩后用户程序能继续正常运行。

$(3)$ 检査每个占用块中存储的数据。若有指向其他存储块的指针，则需作相应修改。

$(4)$ 将所有占用块迁移到新地址去。这实质上是作传送数据的工作。

至此，完成了存储紧缩的操作。最后，将堆指针赋以新值（即紧缩后的空闲存储区的最低地址），可见，存储紧缩法比无用单元收集法更为复杂，前者不仅要传送数据（进行占用块迁移），而且要修改所有占用块中的指针值。因此，存储紧缩也是一个系统操作，且非不得已就不用。