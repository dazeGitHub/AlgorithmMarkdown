
#### VSAM 文件

虚拟存储存取方法 VSAM 是 Virtual Storage Access Method 的缩写。这种存取方法利用了操作系统的虚拟存储器的功能，给用户提供方便。对用户来说，文件只有控制区间和控制区域等逻辑存储单位，与外存储器中柱面、磁道等具体存储单位没有必然的联系。用户在存取文件中的记录时，不需要考虑这个记录的当前位置是否在内存，也不需要 考虑何时执行对外存进行“读/写”的指令。

VSAM 文件的结构如图 12.11 所示。它由 3 部分组成：索引集、顺序集和数据集。

![](https://gitee.com/mayundaze/img_bed/raw/master/20200806103837.png)

文件的记录均存放在数据集中，数据集中的一个结点称为控制区间（Control Interval），它是一个I/O操作的基本单位,它由一组连续的存储单元组成。控制区间的大小可随文件 不同而不同，但同一文件上控制区间的大小相同。每个控制区间含有一个或多个按关键字递增有序排列的记录。顺序集和索引集一起构成一棵 B+树，为文件的索引部分。顺序集中存放每个控制区间的索引项。每个控制区间的索引项由两部分信息组成，即该控制区间中的最大关键字和指向控制区间的指针。若干相邻控制区间的索引项形成顺序集中的一个结点，结点之间用指针相链结，而每个结点又在其上一层的结点中建有索引，且逐层向上建立索引。所有的索引项都由最大关键字和指针两部分信息组成，这些高层的索引项形成 B+树的非终端结点。因此，VSAM 文件既可在顺序集中进行顺序存取，又可从最高层的索引（B+树的根结点）出发进行按关键字存取。顺序集中一个结点连同其对应的所有控制区间形成一个整体，称做控制区域（Control Range）。每个控制区间可视为个逻辑磁道，而每个控制区域可视为一个逻辑柱面。

在 VSAM 文件中，记录可以是不定长的，则在控制区间中除了存放记录本身以外，还有每个记录的控制信息（如记录的长度等）和整个区间的控制信息（如区间中存有的记录数等），控制区间的结构如图 12.12 所示。在控制区间上存取一个记录时需从控制区间的两端出发同时向中间扫描。

![](https://gitee.com/mayundaze/img_bed/raw/master/20200806103924.png)

VSAM 文件中没有溢出区，解决插入的办法是在初建文件时留有空间。一是每个控制区间内不填满记录，在最末一个记录和控制信息之间留有空隙；二是在每个控制区域中有一些完全空的控制区间，并在顺序集的索引中指明这些空区间。当插人新记录时，大多数的新记录能插人到相应的控制区间内，但要注意为了保持区间内记录的关键字自小至大有序，则需将区间内关键字大于插入记录关键字的记录向控制信息的方向移动。若在若干记录插入之后控制区间已满，则在下一个记录插入时要进行控制区间的分裂，即将近乎一半的记录移到同一控制区域中全空的控制区间中，并修改顺序集中相应索引。倘若控制区域中已经没有全空的控制区间，则要进行控制区域的分裂，此时顺序集中的结点亦要分裂，由此尚需修改索引集中的结点信息。但由于控制区域较大，很少发生分裂的情况。

在 VSAM 文件中删除记录时，需将同一控制区间中较删除记录关键字大的记录向前移动，把空间留给以后插入的新记录。若整个控制区间变空，则需修改顺序集中相应的索引项。

由此可见，VSAM 文件占有较多的存储空间，一般只能保持约 75%的存储空间利用率。但它的优点是：动态地分配和释放存储空间，不需要对文件进行重组，并能较快地对插入的记录进行査找，査找一个后插入记录的时间与査找一个原有记录的时间是相同的。

为了作性能上的优化，VSAM 用了一些其他的技术，如指针和关键字的压缩、索引的存放处理等。其详情读者可参阅参考书目 [13]。
