
#### 直接存取文件 (散列文件)

直接存取文件指的是利用杂凑（Hash）法进行组织的文件。它类似于哈希表，即根据文件中关键字的特点设计一种哈希函数和处理冲突的方法将记录散列到存储设备上，故又称散列文件。

与哈希表不同的是，对于文件来说，磁盘上的文件记录通常是成组存放的。若干个记录组成一个存储单位，在散列文件中，这个存储单位叫做桶（Bucket）。假若一个桶能存放 $m$ 个记录，这就是说，$m$ 个同义词的记录可以存放在同一地址的桶中，而当第 $m + 1$ 个同义词出现时才发生“溢出”。处理溢出也可采用哈希表中处理冲突的各种方法，但对散列文件，主要采用链地址法。

当发生“溢出”时，需要将第 $m + 1$ 个同义词存放到另一个桶中，通常称此桶为“溢出桶”；相对地，称前 $m$ 个同义词存放的桶为“基桶”。溢出桶和基桶大小相同，相互之间用指针相链接。当在基桶中没有找到待查记录时，就顺指针所指到溢出桶中进行査找。因此，希望同一散列地址的溢出桶和基桶在磁盘上的物理位置不要相距太远，最好在同一柱面上。

> 例如，某一文件有 18 个记录，其关键字分别为 278,109,063,930,589,184,505,269,008,083,164,215,330,810,620,110,384,355。桶的容量 $m = 3$, 桶数 $b = 7$。用除留余数法作哈希函数 $H(key)=key MOD 7$。由此得到的直接存取文件如图 12.13 所示。

![](https://gitee.com/mayundaze/img_bed/raw/master/20200806110906.png)

在直接文件中进行查找时，首先根据给定值求得哈希地址（即基桶号），将基桶的记录读入内存进行顺序査找，若找到关键字等于给定值的记录，则检索成功；否则，若基桶内没有填满记录或其指针域为空，则文件内不含有待查记录；否则根据指针域的值的指示将溢出桶的记录读入内存继续进行顺序查找，直至检索成功或不成功。因此，总的查找时间为：

$\qquad T = a(te + ti)$

其中：a 为存取桶数的期望值（相当于哈希表中的平均査找长度），对链地址处理溢出来说，$\begin{aligned} a = 1 + \frac{a}{2} \end{aligned}$; te 为存取一个桶所需的时间；$ti$ 为在内存中顺序査找一个记录所需时间。

$\alpha$ 为装载因子，在散列文件中

$\qquad\begin{aligned} \alpha = \frac{n}{b m} \end{aligned}$

其中：$n$ 为文件的记录数，$b$ 为桶数，$m$ 为桶的容量。显然，增加 $m$ 可减少 $\alpha$，也就使 $a$ 减小，此时虽则使 $ti$ 增大，但由于 $te >> ti$，则总的时间 $T$ 仍可减少。图 12.14 展示了 $\alpha$ 和 $a$ 的关系。

![](https://gitee.com/mayundaze/img_bed/raw/master/20200806110931.png)

在直接存取文件中删除记录时，和哈希表一样，仅需对被删记录作一标记即可。

##### 总结

总之，直接存取文件的优点是：

1. 文件随机存放，记录不需进行排序；插入、删除方便，存取速度快，不需要索引区，节省存储空间。

其缺点是：

1. 不能进行顺序存取，只能按关键字随机存取，且询问方式限于简单询问。
2. 并且在经过多次的插入、删除之后，也可能造成文件结构不合理，即溢出桶满而基桶内多数为被删除的记录。此时亦需重组文件。
