
#### 多关键字文件

##### 1. 多关键字文件的特点

多关键字文件的特点是，在对文件进行检索操作时，不仅对主关键字进行简单询向，还经常需要对次关键字进行其他类型的询问检索。

> 例如，图 12.1 的高考成绩文件中，准考证号码为主关键字，“总分”和各单科成绩为次关键字。允许对此文件作如下询问：总分在 600 分以上的记录；数学的平均分数，等等。如果文件组织中只有主关键字索引，则为回答这些对次关键字的询问，只能顺序存取文件中的每一个记录进行比较，从而效率很低。

为此，对多关键字文件，除了按以上几节讨论的方法组织文件之外，尚需建立一系列的次关键字索引。次关键字索引可以是稠密的，也可以是非稠密的；索引表可以是顺序表，也可以是树表。和主关键字索引表不同，每个索引项应包含次关键字、具有同一次关键字的多个记录的主关键字或物理记录号。下面讨论两种多关键字文件的组织方法。

##### 2. 多重表文件

多重表文件（Multilist File）的特点是：记录按主关键字的顺序构成一个串联文件，并建立主关键字的索引（称为主索引）；对每一个次关键字项建立次关键字索引（称为次索引），所有具有同一次关键字的记录构成一个链表。主索引为非稠密索引，次索引为稠密索引。每个索引项包括次关健字、头指针和链表长度。

![](https://gitee.com/mayundaze/img_bed/raw/master/20200806111834.png)

> 例如，图 12.15 所示为一个多重链表文件。其中，学号为主关键字，记录按学号顺序链接，为了查找方便，分成 3 个子链表，其索引如图 12.15 (b）所示，索引项中的主关键字为各子表中的最大值。专业、已修学分和选修课目为 3 个次关键字项，它们的索引如图 12.15 (c) ~ (e）所示，具有相同次关键字的记录链接在同一链表中。有了这些次关键字索引，便容易处理各种次关键字的询问。例如，若要査询已修学分在 400 分以上的学生，只要在索引表上査找 400~449 这一项，然后从它的链表头指针出发，列出该链表中所有记录即可。又如，若要查询是否有同时选修甲和乙课程的学生，则或从索引表上“甲”的头指针出发，或从“乙”的头指针出发，读出每个记录，察看是否同时选修这两门课程。此时可先比较两个链表的长度，显然应读出长度较短的链表中的记录。

多重链表文件易于构造，也易于修改。如果不要求保持链表的某种次序，则插入一个新记录是容易的，此时可将记录插在链表的头指针之后。但是，要删去一个记录却很繁琐，需在每个次关键字的链表中删去该记录。

##### 3. 倒排文件

倒排文件和多重表文件的区别在于次关键字索引的结构不同。通常，称倒排文件中的次关键字索引为倒排表，具有相同次关键字的记录之间不设指针相链，而在倒排表中该次关键字的一项中存放这些记录的物理记录号。例如，上例文件的倒排表如图 12.16 所示。

![](https://gitee.com/mayundaze/img_bed/raw/master/20200806111948.png)

倒排表作索引的好处在于检索记录较快。特别是对某些询问，不用读取记录，就可得到解答，如询问“软件”专业的学生中有否选课程“乙”的，则只要将“软件”索引中的记录号和“乙”索引中的记录号作求“交”的集合运算即可

在插入和删除记录时，倒排表也要作相应的修改，值得注意的是倒排表中具有同一次关键字的记录号是有序排列的，则修改时要作相应移动。

若数据文件非串链文件，而是索引顺序文件（如 ISAM 文件），则倒排表中应存放记录的主关键字而不是物理记录号。

倒排文件的缺点是维护困难。在同一索引表中，不同的关键字其记录数不同，各倒排表的长度不等，同一倒排表中各项长度也不等
